<% if params[:id].blank? %>

<div class="box" style="width:600px;">
	<%= render :partial => 'boxtop', :locals=>{:title=>"Choose a campaign"} %>
	<div class="box-content">
		<% @user.campaigns.each do |c| %>
		<a href="/client/reports/<%= c.id %>"><%= c.name %></a><br/>
		<% end %>
	</div>
</div>

<% else %>
<% form_tag do %>
  
<form method="post" style="padding:0; margin:0;">
Recent timeframe:	<select name="timeframe" style="padding:0; margin:0;" onchange="document.forms[0].submit();">
		<% 
		count = 0
		10.times do
		  count += 10
		%>
		  <option value="<%= count.to_s %>" <% if params[:timeframe]==count.to_s %>selected<% end %>><%= count.to_s %></option>
		<%
		end
		 %>
		  <option value="1000000" <% if params[:timeframe]=="1000000" %>selected<% end %>>All time</option>
	</select> minutes
</form><br/>
<% end -%>

<div id="status">Loading...</div>
<%= periodically_call_remote(:url => { :action => 'update_report', :id=>params[:id], :timeframe=>params[:timeframe] }, :update => 'status',  :frequency => '5')  %>
<script>
<%= remote_function(:url => { :action => 'update_report', :id=>params[:id] , :timeframe=>params[:timeframe]}, :update => 'status',  :frequency => '5')  %>
</script>
<% end %>


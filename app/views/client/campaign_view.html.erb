
<div id="callerid"></div>
<% form_for :campaign, :url => { :action => "campaign_add" , :id=>@campaign.id}, :html => {:name => 'callerForm', :id => 'callerForm'}   do |f| %>
<div id="content" style="width:100%;">


	<table width="100%" style="padding:10px;"> 
		<tr>
			<td valign="top" width="32%">

				<!--<div id="sidebar" style="width:250; margin-top:2px; margin-right:6px;">-->

					<!-- Box -->
					<div class="box">
					  <!-- Box Head -->
					  <div class="box-head">
					    <h2>Campaign Info</h2>
					  </div>
					  <!-- End Box Head-->
					  	<div class="box-content"> 
					        <label>Name:</label><br/>
							<%= f.text_field :name, {:class=>"field size3"} %>
							<br/>
							<br/>

					        <label>Caller ID:</label><br/>
							<%= f.text_field :caller_id, {:class=>"field size3"} %>
							<br/>
							<br/>

							Script:
							<br/><div style="font-size:18px; padding-top:6px; ">
							<%= f.collection_select(:script_id, Script.find_all_by_user_id_and_active(@user.id,1), :id, :name, { :prompt => true},  {:class=>"field"} 	)  %>
						</div>
						<br/>
						<label>Dialing Mode:</label><br/>
						<select class="field" id="campaign_predective_type" name="campaign[predective_type]"> 
							<% public_dialers=["preview","power_2x","power_3x","power_4x"] %>
							<% if !public_dialers.index(@campaign.predective_type) %>
								<option value="@campaign.predective_type" selected><%= @campaign.predective_type %></option>
							<% end %>
							<% public_dialers.each do |d| %>
							<option value="<%= d %>" <% if @campaign.predective_type==d %>selected<% end %>>
								<% if d=="preview" %>Preview
								<% else %>
									Power <%= d.gsub("power_","") %>
								<% end %>
							</option>
							<% end %>
						</select>
 <br/>
						<% if !@campaign.user.recordings.blank? %>
							<br/>
							<label> <%= f.check_box :use_recordings, :onclick=>"doRecord();"%> &nbsp; Leave message</label>
							<br/><br/>
							<div id="recordingsdiv" <% if  !@campaign.use_recordings?%> style="display:none;" <% end %>> 
							Recording:
							<br/><div style="font-size:18px; padding-top:6px; ">
							
							<%= f.collection_select(:recording_id, Recording.find_all_by_user_id_and_active(@user.id,1), :id, :name, { :prompt => false},  {:class=>"field", :onchange=>"updatePreview();"}  )  %></div>
							<div id="sndPreview"></div>
							</div>
						<% end %>
						<p><input type="button" class="button" value="Manage Recordings" onclick="document.location.href='/client/recording_add?campaign_id=<%= @campaign.id %>';"/></p>
							<br/>
							Call-in number:
							<br/><div style="font-size:18px; padding-top:6px; "> 
							<% if ENV["RAILS_ENV"]=="development"%>
								<%= number_to_phone(APP_NUMBER, :area_code => true) %>
							<% else %>
								<%= number_to_phone(@campaign.callin_number, :area_code => true) %>
							<% end %>
							</div>
							<br/>
							Campaign ID:
							<br/><div style="font-size:18px; padding-top:6px; "> <%= @campaign.group_id %></div>
							<!--
							<br/>
							<label> <%= f.check_box :use_web_ui %> &nbsp; Allow Web Interface</label>
							<br/>-->
						</div>
					</div>
					<!-- End Box -->
				    <!-- End Sidebar -->
				    <div class="cl">&nbsp;</div>



				<!--</div>-->

			</td>
			<td> &nbsp; </td>
			<td width="32%" valign="top">
				<div class="box">
					<%= render :partial => 'boxtop', :locals=>{:title=>"Available Lists"} %>
					<% if @lists.length==0 %>
						<div class="form">
				      		<label>No lists entered.</label>
						</div>
			  			<div class="box-content"> 
							<a href="/client/voter_upload/<%= @campaign.id %>" class="add-button"><span>Upload Voters</span></a>
							<div class="cl">&nbsp;</div><br/>
							<% if @show_voter_buttons %>
							<a href="/client/voter_add?campaign_id=<%= @campaign.id %>" class="add-button"><span>Enter Voter</span></a>
							<div class="cl">&nbsp;</div><br/>
							<% end %>
						</div>
					<% else %>
				  		<div class="box-content">
							<div class="table2">
								<table border="0" cellspacing="0" cellpadding="0">
									<tr>
										<th>Name</th>
										<th nowrap>Phone #s</th>
										<th>Remaining</th>
									</tr>
				    				<% @lists.each do |l| %>
										<tr>
											<td valign="top"><%= check_box_tag "voter_list_ids[]", "#{l.id}", l.enabled -%> <%= l.name %></td>
											<td valign="top"><%= l.voters.size %> <%# Voter.find_all_by_voter_list_id(l.id).length %></td>
											<td valign="top"><%# l.voters.collect{|v| v.id if v.result_digit.blank?}.reject(&:blank?).length %> <%= Voter.find_all_by_voter_list_id_and_active(l.id,1, :conditions=>"status= 'Not Called' or call_back=1").size %></td>
										</t>
									<% end %>
								</table>
								<input type="hidden" name="listsSent" value="1">
								<% if @show_voter_buttons %><br/><br/><% end %>
								(uncheck to stop calling)<br/><br/>
							</div>

				  			<div class="box-content" > 
								<a href="/client/voter_upload/<%= @campaign.id %>" class="add-button"><span>Upload New List</span></a>
								<div class="cl">&nbsp;</div>
								<% if false && @show_voter_buttons %>
								<a href="/client/voter_add?campaign_id=<%= @campaign.id %>" class="add-button"><span>Enter Voter</span></a>
								<div class="cl">&nbsp;</div><br/>
								<a href="/client/voter_view?campaign_id=<%= @campaign.id %>" class="button"><span>View Voters</span></a>
								<div class="cl">&nbsp;</div>
								<% end %>
							</div>

						</div>
					<% end %>
			  	</div>
			</td>
			<td> &nbsp; </td>
			<td width="32%" valign="top">
				<div class="box">
					<%= render :partial => 'boxtop', :locals=>{:title=>"Callers With Access"} %>
					<div class="box-content">
						<% if @callers.length==0 %>
							<div class="form">
						      <label>No callers entered.</label>
							</div>
					  		<div class="box-content"> 
								<a href="/client/callers" class="add-button"><span>Add callers</span></a>
								<div class="cl">&nbsp;</div>
							</div>
						<% else %>
						<!--
					  		<div class="box-content" style="float:right;"> 
								<a href="/client/caller_add" class="add-button"><span>Add Caller</span></a>
								<div class="cl">&nbsp;</div><br/>
							</div>
						-->
						  	<div class="table2">
										    <table width="100%" border="0" cellspacing="0" cellpadding="0">
									<tr>
										<th>Name</th>
										<th>&nbsp;</th>
										<th>PIN</th>
										<% if @campaign.predective_type.index("robo,") %>
										<th></th>
										<th></th>
										<% end %>
									</tr>
									<tr>
										<td><input type="checkbox" value="0" id="listUse" onclick="allCallers();"> All Callers</td>
										<td></td>
										<td></td>
									</tr>
					    			<% @callers.each do |l| %>
										<tr>
											<td><%= check_box_tag "campaign[caller_ids][]", "#{l.id}", callerInCampaign(l), :onclick=>"someCallers();" -%> <%= l.name %></td>
											<td></td>
											<td><%= l.pin %></td>
											<% if @campaign.predective_type.index("robo,") %>
											<td><a href="/client/robo_session_start?caller_id=<%= l.id %>&campaign_id=<%= @campaign.id %>">start</a></td>
											<td><a href="/client/robo_session_end?caller_id=<%= l.id %>&campaign_id=<%= @campaign.id %>">end</a></td>
											<% end %>
											
										</tr>
							<% end %>
							</table>
							<br/>
						  </div>
						  <!-- Table -->
						<% end %>
					</div>
				</div>
			</td>
		</tr>
	</table>


</div>
<%# float_sidebar %>

<script>
function allCallers() {
	var f = document.forms['callerForm'].elements['campaign[caller_ids][]'];

	for(var i = 0; i < f.length; i++){
		f[i].checked = true;
	}

}
function someCallers() {
	$('listUse').checked=false;
	isAll();
}

function isAll(){
	var f = document.forms['callerForm'].elements['campaign[caller_ids][]'];
	var n=0;
	for(var i = 0; i < f.length; i++){
		if (f[i].checked == true)
		n++;
	}
	if (n==<%= @callers.length %>){
		$('listUse').checked=true;

		}
}
<% if @callers.length!=0 %>
isAll();
<% end %>
<%= remote_function(:update => "callerid",
      :url => { :action => "campaign_caller_id_verified", :id=>@campaign.id }) %>

function doRecord(){
	if($('campaign_use_recordings').checked){
		$('recordingsdiv').style.display='block';
	} else {
		$('recordingsdiv').style.display='none';		
	}
}

	<% if !@campaign.user.recordings.blank? %>
function updatePreview(){
	recording_id = $('campaign_recording_id').value;
	<%@user.recordings.each do |recording| %>
		if (recording_id==<%= recording.id %>){
			path='<%= recording.recording_url %>';
			name='<%= escape_javascript recording.name %>';
		}
	<% end %>

	var o = 'Preview: ' + name + '<br/>';

	if (path.indexOf('mp3')>-1)
		o = o + '<object type="application/x-shockwave-flash" width="200" height="14" data="/xspf_player_slim.swf?player_title=' + name + '&song_title=' + name + '&song_url=' + escape(path) +'"><param name="movie" value="/xspf_player_slim.swf?player_title=' + name + '&song_title=' + name + '&song_url=' + escape(path) +'" /></object>';
	else
		o = o + '<EMBED SRC="' +  path + '" WIDTH="240" HEIGHT = "25" AUTOPLAY="false" CONTROLLER="true" LOOP="false" PLUGINSPAGE="http://www.apple.com/quicktime/">';
	$('sndPreview').innerHTML=o;
}
<% end %>
updatePreview();
</script>

<% end %>
<div>&nbsp;</div>




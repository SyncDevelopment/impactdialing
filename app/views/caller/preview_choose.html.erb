<html><body>
<div id="previewInfo">
	<div id="previewvoterInfo"></div>
	<div id="callButton"></div>
	<div id="nextButton"><input type="button" onclick="showPreview();" value="Skip"></div>
</div>


<script>
voters=[]
formatted_phone_numbers = [];
<% @voters.each do |v| %>
    <%custom_fields = ""%>
    <% v.custom_voter_field_values.each{|vf| custom_fields += "<p> #{vf.custom_voter_field.name} : #{vf.value} </p>" if vf.custom_voter_field}%>
    formatted_phone_numbers.push( <%=number_to_phone(v.Phone.to_s, :groupings => [4, 3, 3], :delimiter => "-", :area_code => true).to_json%> );
	v=["<%= escape_javascript v.FirstName %>","<%= escape_javascript v.LastName %>","<%= escape_javascript v.Phone %>","<%=  v.id %>","<%= custom_fields%>"]
	voters.push(v)
<% end %>

currPreview=0;

function showPreview(){
	curVoter = voters[currPreview];
	document.getElementById('previewvoterInfo').innerHTML='Name: ' + curVoter[0] + ' ' + curVoter[1] + '<br/>Phone: ' + formatted_phone_numbers[currPreview];
	document.getElementById('callButton').innerHTML='<input type="button" onclick="dialVoter(' + curVoter[3] + ');" value="Dial">';
	currPreview++;
	if (currPreview>=voters.length)
		currPreview=0;
}
function dialVoter(vid){
	document.location.href='/caller/preview_dial?key=<%= params[:key] %>&voter_id=' + vid;
}
showPreview();
</script>
</body></html>
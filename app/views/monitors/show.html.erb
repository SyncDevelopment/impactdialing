<% content_for :javascripts do %>
<script type="text/javascript" src="https://static.twilio.com/libs/twiliojs/1.0/twilio.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
<script src="https://d3dy5gmtp8yhk7.cloudfront.net/1.11/pusher.min.js" type="text/javascript" ></script>
<%= javascript_include_tag 'monitors/jquery.stopwatch', 'monitors/monitors', 'monitors/assign_caller_to_campaign','ICanHaz.min.js' %>

<% end %>

<input id= "monitor_session_id" type="hidden" value="<%= @monitor_session %>">

<script id="campaign" type="text/html">
  {{update_campaign_info}}
    <tr id="campaign_info" class="campaign <%= cycle("odd", "even") %>" >
       <td id="callers_logged_in">{{callers_logged_in}}</td>
       <td id="on_call">{{on_call}}</td>
       <td id="on_hold">{{on_hold}}</td>       
       <td id="wrap_up">{{wrap_up}}</td>       
       <td id="live_lines">{{live_lines}}</td>       
       <td id="ringing_lines">{{ringing_lines}}</td>              
       <td id="numbers_available">{{numbers_available}}</td>
       <td id="numbers_remaining">{{numbers_remaining}}</td>       
    </tr>
  {{/update_campaign_info}}
</script>

<script id="caller" type="text/html">
  <tr id="caller_{{session_id}}" class="caller <%= cycle("odd", "even") %> " session_id={{session_id}} caller_id={{id}}>
      <td class="caller_name">{{email}}</td>
      <td class="campaigns"></td>
			<td class="status">On hold</td>
			<td>
				<div class="timer">
					<div class="display"><span class="hr">00</span>:<span class="min">00</span>:<span class="sec">00</span></div>
				<div>
			</td>
      <td>
        <a class ="action secondary monitor" href="#" action="eavesdrop" session_id={{session_id}}>Eavesdrop</a>
      </td>
      <td>
        <a class ="action secondary monitor" href="#" action="breakin" session_id={{session_id}}>Break in</a>
      </td>
      <td>
        <a class ="action secondary monitor" href="#" action="kickoff" session_id={{session_id}}>Kick off</a>
      </td>      
  </tr>
</script>

<%= render :partial => 'campaign' %>
<%= render :partial => 'callers' %>

<script type="text/javascript">
  var pusher = new Pusher("<%= Pusher.key %>");      
  channel = pusher.subscribe($('#monitor_session_id').val());
  var monitors = new Monitors(channel)
  monitors.setup_twilio("<%= @token %>")
  $(window).bind("beforeunload", function(){
    monitors.de_activate_monitor($('#monitor_session_id').val());
  });      
</script>

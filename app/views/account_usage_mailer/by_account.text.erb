<%
  headers = ['Account ID', 'Account Type', 'Billable Minutes']
  names = [@accounts.map(&:id).map(&:to_s), @accounts.map(&:subscription_name) + ['No current subscription'], @billable_totals.values.map(&:to_s)]
  longest = [0,0,0]
  if @include_undebited
    headers << 'Undebited Minutes'
    names << @undebited_totals.values.map(&:to_s)
    longest << 0
  end
  [headers,names].each do |items|
    items.each_with_index do |str,i|
      next if str.blank?
      l = longest[i]
      l = str.size > l ? str.size : l
      longest[i] = l
    end
  end
  # padding
  longest.map{|l| l += 5}
-%>
Account Usage Report (<%= @from_date.strftime('%m-%d-%Y') %> - <%= @to_date.strftime('%m-%d-%Y') %>)

<%= 'Account ID'.ljust(longest[0]) %> <%= 'Account Type'.ljust(longest[1]) %> <%= 'Total Minutes'.ljust(longest[2]) %><%= ' Undebited Minutes'.ljust(longest[3]) if @include_undebited %><%= 'Email' %>

<% @accounts.each do |account| %>
<%= account.id.to_s.ljust(longest[0]) %> <%= (account.current_subscription.try(:type).try(:to_s) || 'No current subscription').ljust(longest[1]) %> <%= (@billable_totals[account.id] || 0).to_s.ljust(longest[2]) %><%= ' ' + (@undebited_totals[account.id] || 0).to_s.ljust(longest[3]) if @include_undebited %> <%= account.users.first.try(:email) || 'No users' %>
<% end %>

Billable Total (all accounts) <%= number_with_delimiter(@grand_total) %> minutes

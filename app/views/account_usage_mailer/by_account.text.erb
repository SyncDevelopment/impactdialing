<%
  headers = ['Account ID', 'Account Type', 'Total Minutes', 'Undebited Minutes', 'Email']
  names = (@accounts.map(&:id) + @accounts.map(&:subscription_name) + @billable_totals.values + @undebited_totals.values).flatten
  longest = 0
  (headers + names).each{|str| longest = (str.try(:size)||0) > longest ? (str.try(:size)||0) : longest}
  longest += 5
-%>
Account Usage Report (<%= @from_date.strftime('%d-%m-%Y') %> - <%= @to_date.strftime('%d-%m-%Y') %>)

<%= 'Account ID'.ljust(longest) %> <%= 'Account Type'.ljust(longest) %> <%= 'Total Minutes'.ljust(longest) %><%= ' Undebited Minutes'.ljust(longest) unless @undebited_totals.empty? %><%= 'Email' %>

<% @accounts.each do |account| %>
<%= account.id.to_s.ljust(longest) %> <%= (account.current_subscription.type.try(:to_s) || 'Unknown...').ljust(longest) %> <%= (@billable_totals[account.id] || 0).to_s.ljust(longest) %><%= ' ' + (@undebited_totals[account.id] || 0).to_s.ljust(longest) unless @undebited_totals.empty? %> <%= account.users.where('email is not null').first.email %>
<% end %>

Billable Total (all accounts) <%= @grand_total %>

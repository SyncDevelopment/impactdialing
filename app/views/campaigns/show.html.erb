<h1>Edit campaign</h1>

<div id="callerid"></div>

<% form_for @campaign, :html => {:name => 'callerForm', :id => 'callerForm'} do |f| %>
    <fieldset>
	  <legend>Campaign options</legend>
      <fieldset>
        <legend>Basic settings</legend>
        <p><label for="">Name</label><br>
          <%= f.text_field :name, {:class=>"field size3"} %></p>

        <p><label for="">Caller ID</label><br>
          <%= f.text_field :caller_id, {:class=>"field size3"} %></p>
	      <div class="buttons">
	        <button type="submit">Verify this Caller ID</button>
	      </div>

        <p><label for="">Message for live call</label><br>
          <%= f.collection_select(:script_id, Script.find_all_by_user_id_and_active(@user.id, 1), :id, :name, {:prompt => true}, {:class=>"field"}) %>
        </p>
      </fieldset>
      <fieldset>
        <legend>Available lists</legend>
        <% if @lists.length==0 %>
            <p>You haven't uploaded any lists yet.</p>

            <% if @user.show_voter_buttons? %>
                <a href="/client/voter_add?campaign_id=<%= @campaign.id %>" class="add-button"><span>Enter Voter</span></a>
            <% end %>
        <% else %>
        Uncheck a list to stop calling it:
            <table border="0" cellspacing="0" cellpadding="0">
              <tr>
                <th>Name</th>
                <th nowrap>Phone #s</th>
                <th>Remaining</th>
              </tr>
              <% @lists.each do |l| %>
                  <tr>
                    <td valign="top"><%= check_box_tag "voter_list_ids[]", "#{l.id}", l.enabled -%> <%= l.name %></td>
                    <td valign="top"><%= l.voters.size %> <%# Voter.find_all_by_voter_list_id(l.id).length %></td>
                    <td valign="top"><%# l.voters.collect{|v| v.id if v.result_digit.blank?}.reject(&:blank?).length %> <%= Voter.find_all_by_voter_list_id_and_active(l.id, 1, :conditions=>"status= 'Not Called' or call_back=1").size %></td>
                  </tr>
              <% end %>
            </table>
            <input type="hidden" name="listsSent" value="1">

            <% if @user.id==1 && @user.show_voter_buttons? %>
                <a href="/client/voter_add?campaign_id=<%= @campaign.id %>" class="add-button"><span>Enter Voter</span></a>
                <a href="/client/voter_view?campaign_id=<%= @campaign.id %>" class="button"><span>View Voters</span></a>
            <% end %>
        <% end %>
      </fieldset>
      <div class="buttons">
        <button type="submit">Save</button>
      </div>
    </fieldset>
<% end %>
<fieldset>
  <legend>Add Lists</legend>
    <%= render :partial => "voter_lists/new" %>
</fieldset>

<script>
    <%= remote_function(:update => "callerid", :url => { :action => "verify_callerid", :id=>@campaign.id }) %>
</script>
